apiVersion: skaffold/v2beta28
kind: Config
metadata:
  name: horizon-stream
build:
  artifacts:
  - image: opennms/horizon-stream-core
    context: platform
    custom:
      buildCommand: ./skaffold-build.sh
      dependencies:
        paths: ["."]
        ignore: [
          "**/target/**", 
          "**/dependency-reduced-pom.xml" # generated by maven-shade-plugin, these cause file watching to break when running `skaffold debug`
        ]
  - image: opennms/horizon-stream-api
    context: rest-server
    jib: {}
    sync:
      auto: true
  - image: opennms/horizon-stream-ui-dev
    context: ui
    sync:
      infer:
        - '**/*.ts'
        - '**/*.tsx'
        - '**/*.css'
        - '**/*.vue'
    docker:
      dockerfile: dev/Dockerfile

portForward:
  - resourceType: deployment
    resourceName: my-horizon-stream-ui
    port: 3000
  - resourceType: deployment
    resourceName: my-horizon-stream-api
    port: 9090
  - resourceType: deployment
    resourceName: my-horizon-stream-core
    port: 8181
    localPort: 18181
  - resourceType: deployment
    resourceName: my-horizon-stream-core
    port: 8101
    localPort: 18101
  - resourceType: deployment
    resourceName: my-keycloak
    port: 8080
    localPort: 28080
  - resourceType: deployment
    resourceName: my-minion
    port: 8201
    localPort: 38101

deploy:
  kubectl:
    manifests:
    - dev/kubernetes.kafka.yaml
